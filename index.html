<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LodgeMate - Find your dream apartment in Minna">
    <meta name="theme-color" content="#18181b">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <title>LodgeMate - Find Your Dream Home in Minna</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ </text></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://unpkg.com">
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        *, *::before, *::after { box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        :root {
            --radius: 0.625rem;
            --background: #ffffff;
            --foreground: #09090b;
            --card: #ffffff;
            --card-foreground: #09090b;
            --muted: #f4f4f5;
            --muted-foreground: #71717a;
            --border: #e4e4e7;
            --input: #e4e4e7;
            --primary: #18181b;
            --primary-foreground: #fafafa;
            --secondary: #f4f4f5;
            --secondary-foreground: #18181b;
            --accent: #f4f4f5;
            --accent-foreground: #18181b;
            --ring: #18181b;
            --violet: #8b5cf6;
            --violet-hover: #7c3aed;
        }

        html.dark {
            --background: #09090b;
            --foreground: #fafafa;
            --card: #18181b;
            --card-foreground: #fafafa;
            --muted: #27272a;
            --muted-foreground: #a1a1aa;
            --border: #27272a;
            --input: #27272a;
            --primary: #fafafa;
            --primary-foreground: #18181b;
            --secondary: #27272a;
            --secondary-foreground: #fafafa;
            --accent: #27272a;
            --accent-foreground: #fafafa;
            --ring: #d4d4d8;
        }

        body {
            font-family: 'Geist', system-ui, -apple-system, sans-serif;
            background: var(--background);
            color: var(--foreground);
            margin: 0;
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.2s, color 0.2s;
        }

        /* â”€â”€ shadcn primitives â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .shad-btn { display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;border-radius:var(--radius);font-size:0.875rem;font-weight:500;font-family:'Geist',sans-serif;transition:all 0.15s ease;cursor:pointer;border:none;outline:none;white-space:nowrap; }
        .shad-btn:focus-visible { box-shadow:0 0 0 3px rgba(139,92,246,0.35); }
        .shad-btn-default { background:var(--primary);color:var(--primary-foreground);padding:0.5rem 1rem;height:2.5rem; }
        .shad-btn-default:hover { opacity:0.88; }
        .shad-btn-outline { background:transparent;color:var(--foreground);border:1px solid var(--border);padding:0.5rem 1rem;height:2.5rem; }
        .shad-btn-outline:hover { background:var(--accent); }
        .shad-btn-ghost { background:transparent;color:var(--foreground);padding:0.5rem;height:2.5rem;width:2.5rem;border-radius:0.5rem; }
        .shad-btn-ghost:hover { background:var(--accent); }
        .shad-btn-violet { background:var(--violet);color:white;padding:0.625rem 1.5rem;height:3rem;font-size:0.9375rem;font-weight:600;border-radius:0.75rem; }
        .shad-btn-violet:hover { background:var(--violet-hover);transform:translateY(-1px);box-shadow:0 6px 20px rgba(139,92,246,0.35); }
        .shad-btn-green { background:#16a34a;color:white;padding:0.75rem 1.5rem;height:3rem;font-size:0.9375rem;font-weight:600;border-radius:0.75rem; }
        .shad-btn-green:hover { background:#15803d; }
        .shad-card { background:var(--card);color:var(--card-foreground);border:1px solid var(--border);border-radius:calc(var(--radius)+2px); }
        .shad-input { width:100%;padding:0.5rem 0.75rem;border:1px solid var(--input);border-radius:var(--radius);background:var(--background);color:var(--foreground);font-family:'Geist',sans-serif;font-size:0.875rem;height:2.5rem;transition:border-color 0.15s,box-shadow 0.15s;outline:none; }
        .shad-input:focus { border-color:var(--violet);box-shadow:0 0 0 3px rgba(139,92,246,0.15); }
        .shad-input::placeholder { color:var(--muted-foreground); }
        .shad-textarea { width:100%;padding:0.5rem 0.75rem;border:1px solid var(--input);border-radius:var(--radius);background:var(--background);color:var(--foreground);font-family:'Geist',sans-serif;font-size:0.875rem;outline:none;resize:none;transition:border-color 0.15s,box-shadow 0.15s; }
        .shad-textarea:focus { border-color:var(--violet);box-shadow:0 0 0 3px rgba(139,92,246,0.15); }
        .shad-label { font-size:0.875rem;font-weight:500;color:var(--foreground);display:block;margin-bottom:0.375rem; }
        .shad-muted { color:var(--muted-foreground);font-size:0.8125rem; }
        .shad-badge { display:inline-flex;align-items:center;border-radius:9999px;padding:0.125rem 0.625rem;font-size:0.75rem;font-weight:500;border:1px solid var(--border);background:var(--secondary);color:var(--secondary-foreground); }
        .shad-separator { width:100%;height:1px;background:var(--border); }

        /* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @keyframes fadeIn    { from{opacity:0} to{opacity:1} }
        @keyframes slideUp   { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
        @keyframes slideDown { from{opacity:0;transform:translateY(-8px)} to{opacity:1;transform:translateY(0)} }
        @keyframes shimmer   { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
        @keyframes spin      { to{transform:rotate(360deg)} }
        @keyframes pulseRing { 0%{transform:scale(1);opacity:1} 100%{transform:scale(1.8);opacity:0} }
        @keyframes hIn       { from{opacity:0;transform:translateY(18px)} to{opacity:1;transform:translateY(0)} }
        @keyframes cIn       { from{opacity:0;transform:translateX(30px)} to{opacity:1;transform:translateX(0)} }
        @keyframes gradShift { 0%,100%{background-position:0% 50%} 50%{background-position:100% 50%} }

        .animate-fade-in    { animation:fadeIn 0.3s ease both; }
        .animate-slide-up   { animation:slideUp 0.4s ease both; }
        .animate-slide-down { animation:slideDown 0.25s ease both; }

        /* Hero â€” fast stagger, max 0.3s delay */
        .h-a1 { animation:hIn 0.45s cubic-bezier(0.22,1,0.36,1) 0.0s  both; }
        .h-a2 { animation:hIn 0.45s cubic-bezier(0.22,1,0.36,1) 0.08s both; }
        .h-a3 { animation:hIn 0.45s cubic-bezier(0.22,1,0.36,1) 0.16s both; }
        .h-a4 { animation:hIn 0.45s cubic-bezier(0.22,1,0.36,1) 0.24s both; }
        .h-card { animation:cIn 0.55s cubic-bezier(0.22,1,0.36,1) 0.1s both; }

        /* Purple shimmer on "Dream" and "Home" */
        .purple-text {
            background: linear-gradient(120deg,#a78bfa 0%,#c084fc 40%,#e879f9 70%,#a78bfa 100%);
            background-size: 250% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradShift 6s ease infinite;
        }

        /* Respect reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after { animation-duration:0.01ms !important; animation-iteration-count:1 !important; transition-duration:0.01ms !important; }
        }

        /* â”€â”€ Skeleton â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .skeleton { background:linear-gradient(90deg,var(--muted) 25%,var(--secondary) 50%,var(--muted) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:var(--radius); }

        /* â”€â”€ HEADER â€” always solid, never see-through â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .site-header {
            position: sticky;
            top: 0;
            z-index: 50;
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }
        /* Light mode: near-opaque white */
        html:not(.dark) .site-header { background: rgba(255,255,255,0.97); }
        /* Dark mode: near-opaque zinc-950 */
        html.dark .site-header { background: rgba(9,9,11,0.97); }

        /* â”€â”€ Property card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .property-card { transition:transform 0.2s ease,box-shadow 0.2s ease; }
        .property-card:hover { transform:translateY(-3px);box-shadow:0 10px 32px rgba(0,0,0,0.08); }
        html.dark .property-card:hover { box-shadow:0 10px 32px rgba(0,0,0,0.45); }
        .img-wrap { overflow:hidden;background:var(--muted); }
        .img-wrap img { transition:transform 0.3s ease,opacity 0.25s ease;display:block; }
        .img-wrap img.loading { opacity:0; }
        .img-wrap img.loaded  { opacity:1; }
        .property-card:hover .img-wrap img { transform:scale(1.04); }

        /* â”€â”€ Hero responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @keyframes fadeOut { from{opacity:1} to{opacity:0} }
        @media (max-width: 767px) {
            .hero-grid-layout {
                grid-template-columns: 1fr !important;
            }
            .hero-grid-layout > div:last-child {
                order: 2;
                margin-top: 0.5rem;
            }
            .hero-grid-layout > div:first-child {
                order: 1;
            }
        }

        /* â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .hero-section {
            background: linear-gradient(135deg,#09090b 0%,#0f0f14 40%,#12101c 70%,#09090b 100%);
            position: relative;
            overflow: hidden;
        }
        .hero-section::before {
            content:'';position:absolute;inset:0;pointer-events:none;
            background:
                radial-gradient(ellipse 60% 70% at 10% 50%,rgba(139,92,246,0.22) 0%,transparent 60%),
                radial-gradient(ellipse 40% 55% at 90% 20%,rgba(168,85,247,0.13) 0%,transparent 60%),
                radial-gradient(ellipse 30% 40% at 75% 80%,rgba(139,92,246,0.08) 0%,transparent 60%);
        }
        .hero-grid {
            position:absolute;inset:0;pointer-events:none;
            background-image:linear-gradient(rgba(255,255,255,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.025) 1px,transparent 1px);
            background-size:56px 56px;
        }

        /* â”€â”€ Featured card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .live-dot { width:7px;height:7px;background:#22c55e;border-radius:9999px;position:relative;flex-shrink:0; }
        .live-dot::after { content:'';position:absolute;inset:0;border-radius:9999px;background:#22c55e;animation:pulseRing 1.6s ease-out infinite; }

        /* â”€â”€ Gallery â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .gallery-main { position:relative;height:460px;overflow:hidden;border-radius:0.75rem 0.75rem 0 0; }
        @media(max-width:767px){.gallery-main{height:260px;}}
        .thumb { aspect-ratio:1;cursor:pointer;border:2px solid transparent;border-radius:0.5rem;overflow:hidden;transition:border-color 0.15s; }
        .thumb:hover,.thumb.active { border-color:var(--violet); }
        .thumb img { width:100%;height:100%;object-fit:cover; }

        /* â”€â”€ Misc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        /* â”€â”€ Hamburger icon morphs into X â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .hbg { display:flex;flex-direction:column;justify-content:center;align-items:center;
               width:2.25rem;height:2.25rem;gap:5px;background:none;border:none;cursor:pointer;padding:0;position:relative; }
        .hbg span { display:block;width:22px;height:2px;border-radius:2px;
                    background:var(--foreground);
                    transform-origin:center;
                    transition:transform 0.35s cubic-bezier(0.16,1,0.3,1),
                               opacity 0.25s ease,
                               width 0.3s ease; }
        /* Open state â€” morph to X */
        .hbg.open span:nth-child(1) { transform:translateY(7px) rotate(45deg); }
        .hbg.open span:nth-child(2) { opacity:0; width:0; }
        .hbg.open span:nth-child(3) { transform:translateY(-7px) rotate(-45deg); }

        /* Drawer slide */
        @keyframes drawerIn  { from{opacity:0;transform:translateX(-100%)} to{opacity:1;transform:translateX(0)} }
        @keyframes drawerOut { from{opacity:1;transform:translateX(0)} to{opacity:0;transform:translateX(-100%)} }
        .drawer-in  { animation:drawerIn  0.3s cubic-bezier(0.22,1,0.36,1) both; }
        .drawer-out { animation:drawerOut 0.25s cubic-bezier(0.4,0,1,1) both; }
        .modal-backdrop { backdrop-filter:blur(8px);animation:fadeIn 0.2s ease; }
        .modal-content  { animation:slideUp 0.25s ease; }
        .floating-admin { position:fixed;bottom:1.5rem;right:1.5rem;z-index:40; }
        @media(max-width:767px){.floating-admin{display:none!important;}}
        .desc-clamp { display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden; }
        :focus-visible { outline:2px solid var(--violet);outline-offset:2px; }
        .spinner { width:1rem;height:1rem;border:2px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;animation:spin 0.7s linear infinite;display:inline-block;vertical-align:middle; }
        html.dark ::-webkit-scrollbar{width:5px;}
        html.dark ::-webkit-scrollbar-track{background:var(--muted);}
        html.dark ::-webkit-scrollbar-thumb{background:#3f3f46;border-radius:3px;}

        /* â”€â”€ Featured star toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .star-btn { display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:0.5rem;border:1px solid var(--border);background:transparent;cursor:pointer;color:var(--muted-foreground);transition:all 0.15s;flex-shrink:0; }
        .star-btn:hover { background:rgba(251,191,36,0.12);border-color:rgba(251,191,36,0.4);color:#d97706; }
        .star-btn.active { background:rgba(251,191,36,0.25) !important;border-color:rgba(251,191,36,0.7) !important;color:#d97706 !important;box-shadow:0 0 0 2px rgba(251,191,36,0.2); }


    </style>
</head>
<body>
<div id="root"></div>

<script>
function compressImage(dataUrl,maxW,maxH,quality){
    return new Promise(resolve=>{
        var img=new Image();
        img.onload=function(){
            var w=img.width,h=img.height,ratio=Math.min(maxW/w,maxH/h,1);
            w=Math.round(w*ratio);h=Math.round(h*ratio);
            var canvas=document.createElement('canvas');canvas.width=w;canvas.height=h;
            var ctx=canvas.getContext('2d');ctx.imageSmoothingEnabled=true;ctx.imageSmoothingQuality='high';
            ctx.drawImage(img,0,0,w,h);
            var out=canvas.toDataURL('image/webp',quality);
            if(out.length<50)out=canvas.toDataURL('image/jpeg',quality);
            resolve(out);
        };img.src=dataUrl;
    });
}
</script>

<script>
var firebaseConfig={
    apiKey:"AIzaSyBUCtHXwtrxIoHZK2N7aVgYIKRCU9zXI4c",
    authDomain:"lodgemate-3c4ba.firebaseapp.com",
    databaseURL:"https://lodgemate-3c4ba-default-rtdb.europe-west1.firebasedatabase.app",
    projectId:"lodgemate-3c4ba",
    storageBucket:"lodgemate-3c4ba.firebasestorage.app",
    messagingSenderId:"734584656247",
    appId:"1:734584656247:web:e8a808cabb14dd04cc9172"
};
if(!firebase.apps.length)firebase.initializeApp(firebaseConfig);
var db=firebase.database();
</script>

<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel" data-presets="react">

const { useState, useEffect, useCallback, memo } = React;

// â”€â”€ Lazy Image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LazyImg = memo(function LazyImg({ src, alt, className, style }) {
    const [loaded, setLoaded] = useState(false);
    const [error, setError]   = useState(false);
    return (
        <div className="relative w-full h-full">
            {!loaded && !error && <div className="skeleton absolute inset-0" />}
            {!error && (
                <img src={src} alt={alt} loading="lazy" decoding="async"
                    className={`${className} ${loaded ? 'loaded' : 'loading'}`} style={style}
                    onLoad={() => setLoaded(true)} onError={() => setError(true)} />
            )}
            {error && (
                <div className="absolute inset-0 flex items-center justify-center"
                    style={{background:'var(--muted)',color:'var(--muted-foreground)'}}>
                    <i className="fas fa-image text-3xl"></i>
                </div>
            )}
        </div>
    );
});

// â”€â”€ Lightbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const Lightbox = memo(function Lightbox({ images, index, onClose, onNext, onPrev }) {
    useEffect(() => {
        const fn = e => {
            if (e.key==='Escape')     onClose();
            if (e.key==='ArrowRight') onNext();
            if (e.key==='ArrowLeft')  onPrev();
        };
        window.addEventListener('keydown', fn);
        return () => window.removeEventListener('keydown', fn);
    }, [onClose, onNext, onPrev]);

    const btnStyle = (extra={}) => ({
        background:'rgba(255,255,255,0.1)',border:'none',color:'white',cursor:'pointer',
        display:'flex',alignItems:'center',justifyContent:'center',borderRadius:'9999px',...extra
    });
    return (
        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4"
            style={{background:'rgba(0,0,0,0.96)',backdropFilter:'blur(8px)',animation:'fadeIn 0.2s ease'}}
            onClick={onClose}>
            <button onClick={onClose} style={{...btnStyle(),position:'absolute',top:'1rem',right:'1rem',width:'2.75rem',height:'2.75rem',fontSize:'1rem',zIndex:10}}>
                <i className="fas fa-times"></i>
            </button>
            {images.length > 1 && <>
                <button onClick={e=>{e.stopPropagation();onPrev();}} style={{...btnStyle(),position:'absolute',left:'1rem',top:'50%',transform:'translateY(-50%)',width:'3rem',height:'3rem',fontSize:'1.125rem',zIndex:10}}>
                    <i className="fas fa-chevron-left"></i>
                </button>
                <button onClick={e=>{e.stopPropagation();onNext();}} style={{...btnStyle(),position:'absolute',right:'1rem',top:'50%',transform:'translateY(-50%)',width:'3rem',height:'3rem',fontSize:'1.125rem',zIndex:10}}>
                    <i className="fas fa-chevron-right"></i>
                </button>
            </>}
            <img src={images[index]} alt="Full size" decoding="async"
                style={{maxWidth:'100%',maxHeight:'90vh',objectFit:'contain',borderRadius:'0.75rem',animation:'slideUp 0.25s ease'}}
                onClick={e=>e.stopPropagation()} />
            {images.length > 1 && (
                <div style={{position:'absolute',bottom:'1.25rem',left:'50%',transform:'translateX(-50%)',background:'rgba(0,0,0,0.65)',color:'white',padding:'0.25rem 1rem',borderRadius:'9999px',fontSize:'0.8125rem',fontFamily:"'Geist Mono',monospace"}}>
                    {index+1} / {images.length}
                </div>
            )}
        </div>
    );
});

// â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const Header = memo(function Header({ currentPage, darkMode, toggleDarkMode, onNavigateHome, onOpenAdminLogin }) {
    const [menuOpen, setMenuOpen] = useState(false);
    const [closing, setClosing] = useState(false);

    const close = () => {
        setClosing(true);
        setTimeout(() => { setMenuOpen(false); setClosing(false); }, 220);
    };
    const open = () => setMenuOpen(true);

    const navLinkStyle = (active) => ({
        background:'transparent',border:'none',cursor:'pointer',
        fontFamily:"'Geist',sans-serif",fontSize:'0.875rem',
        fontWeight: active ? 600 : 400,
        color: active ? 'var(--foreground)' : 'var(--muted-foreground)',
        padding:'0.5rem 0.75rem',borderRadius:'0.5rem',
        transition:'all 0.15s',display:'inline-flex',alignItems:'center',
    });
    const drawerItemStyle = {
        width:'100%',display:'flex',alignItems:'center',gap:'0.875rem',
        padding:'0.75rem 1rem',borderRadius:'0.75rem',
        background:'transparent',border:'none',cursor:'pointer',
        color:'var(--foreground)',fontFamily:"'Geist',sans-serif",
        fontSize:'0.9375rem',fontWeight:500,textAlign:'left',transition:'background 0.15s'
    };

    return (
        <header className="site-header animate-slide-down">
            <div style={{maxWidth:'80rem',margin:'0 auto',padding:'0 1.5rem'}}>
                <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',height:'64px'}}>
                    {/* Logo */}
                    <button onClick={onNavigateHome} style={{display:'flex',alignItems:'center',gap:'0.625rem',background:'none',border:'none',cursor:'pointer',padding:0}}>
                        <div style={{width:'2rem',height:'2rem',background:'var(--foreground)',borderRadius:'0.5rem',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
                            <i className="fas fa-home" style={{color:'var(--background)',fontSize:'0.8125rem'}}></i>
                        </div>
                        <span style={{fontWeight:700,fontSize:'1.125rem',letterSpacing:'-0.025em',color:'var(--foreground)'}}>LodgeMate</span>
                    </button>

                    {/* Desktop nav */}
                    <nav className="hidden md:flex" style={{alignItems:'center',gap:'0.25rem'}}>
                        <button onClick={onNavigateHome} style={navLinkStyle(currentPage==='home')}>Home</button>
                        <button onClick={toggleDarkMode} className="shad-btn shad-btn-ghost" aria-label="Toggle theme">
                            {darkMode
                                ? <i className="fas fa-sun" style={{fontSize:'1rem',color:'#facc15'}}></i>
                                : <i className="fas fa-moon" style={{fontSize:'1rem',color:'var(--muted-foreground)'}}></i>}
                        </button>
                    </nav>

                    {/* Mobile hamburger â€” morphs to X */}
                    <button className={`md:hidden hbg ${menuOpen?'open':''}`}
                        onClick={menuOpen ? close : open}
                        aria-label={menuOpen ? 'Close menu' : 'Open menu'}>
                        <span/><span/><span/>
                    </button>
                </div>
            </div>

            {/* Drawer */}
            {menuOpen && ReactDOM.createPortal(
                <div style={{position:'fixed',inset:0,zIndex:9999}}>
                    {/* Backdrop */}
                    <div onClick={close}
                        style={{position:'absolute',inset:0,background:'rgba(0,0,0,0.6)',
                            animation: closing ? 'fadeOut 0.22s ease both' : 'fadeIn 0.2s ease both'}} />
                    {/* Panel */}
                    <div className={closing ? 'drawer-out' : 'drawer-in'} style={{
                        position:'absolute',top:0,left:0,bottom:0,width:'17rem',
                        display:'flex',flexDirection:'column',
                        background: darkMode ? '#09090b' : '#ffffff',
                        borderRight:'1px solid var(--border)',
                        boxShadow:'12px 0 40px rgba(0,0,0,0.35)',
                    }}>
                        {/* Drawer header */}
                        <div style={{padding:'1.25rem 1rem',display:'flex',alignItems:'center',justifyContent:'space-between',borderBottom:'1px solid var(--border)'}}>
                            <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                                <div style={{width:'1.75rem',height:'1.75rem',background:'var(--foreground)',borderRadius:'0.4rem',display:'flex',alignItems:'center',justifyContent:'center'}}>
                                    <i className="fas fa-home" style={{color:'var(--background)',fontSize:'0.7rem'}}></i>
                                </div>
                                <span style={{fontWeight:700,letterSpacing:'-0.025em',color:'var(--foreground)',fontSize:'1rem'}}>LodgeMate</span>
                            </div>
                            {/* Animated X button */}
                            <button onClick={close} style={{
                                width:'2rem',height:'2rem',borderRadius:'0.5rem',
                                background:'var(--muted)',border:'none',cursor:'pointer',
                                display:'flex',alignItems:'center',justifyContent:'center',
                                transition:'background 0.15s',color:'var(--foreground)'}}
                                onMouseEnter={e=>e.currentTarget.style.background='var(--accent)'}
                                onMouseLeave={e=>e.currentTarget.style.background='var(--muted)'}>
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                    <path d="M1 1L13 13M13 1L1 13" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                                </svg>
                            </button>
                        </div>
                        {/* Nav items */}
                        <nav style={{padding:'0.75rem',flex:1,display:'flex',flexDirection:'column',gap:'0.25rem'}}>
                            {[
                                {icon:'fa-home',  label:'Home',  fn:()=>{onNavigateHome();close();}},
                                {icon:'fa-lock',  label:'Admin', fn:()=>{onOpenAdminLogin();close();}},
                            ].map((item,i)=>(
                                <button key={item.label} onClick={item.fn}
                                    style={{...drawerItemStyle,animationDelay:`${0.05+i*0.05}s`,animation:'hIn 0.4s cubic-bezier(0.22,1,0.36,1) both'}}
                                    onMouseEnter={e=>e.currentTarget.style.background='var(--accent)'}
                                    onMouseLeave={e=>e.currentTarget.style.background='transparent'}>
                                    <div style={{width:'2rem',height:'2rem',borderRadius:'0.5rem',background:'var(--muted)',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
                                        <i className={`fas ${item.icon}`} style={{color:'var(--muted-foreground)',fontSize:'0.75rem'}}></i>
                                    </div>
                                    {item.label}
                                </button>
                            ))}
                            <button onClick={()=>{toggleDarkMode();close();}}
                                style={{...drawerItemStyle,animationDelay:'0.15s',animation:'hIn 0.4s cubic-bezier(0.22,1,0.36,1) both'}}
                                onMouseEnter={e=>e.currentTarget.style.background='var(--accent)'}
                                onMouseLeave={e=>e.currentTarget.style.background='transparent'}>
                                <div style={{width:'2rem',height:'2rem',borderRadius:'0.5rem',background:'var(--muted)',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
                                    {darkMode
                                        ? <i className="fas fa-sun" style={{color:'#facc15',fontSize:'0.75rem'}}></i>
                                        : <i className="fas fa-moon" style={{color:'var(--muted-foreground)',fontSize:'0.75rem'}}></i>}
                                </div>
                                {darkMode ? 'Light Mode' : 'Dark Mode'}
                            </button>
                        </nav>
                        {/* Footer */}
                        <div style={{padding:'1rem',borderTop:'1px solid var(--border)'}}>
                            <p style={{fontSize:'0.75rem',color:'var(--muted-foreground)',margin:0,textAlign:'center'}}>
                                Â© {new Date().getFullYear()} LodgeMate Â· Minna
                            </p>
                        </div>
                    </div>
                </div>,
                document.body
            )}
        </header>
    );
});

// â”€â”€ Featured Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const FeaturedCard = memo(function FeaturedCard({ property, onView, onWhatsApp }) {
    if (!property) return null;
    const rawPrice = Number(property.price);
    const price = property.price && isFinite(rawPrice) && rawPrice > 0
        ? `â‚¦${rawPrice.toLocaleString()}/yr` : null;
    return (
        <div className="h-card" style={{width:'100%',maxWidth:'28rem',borderRadius:'1.375rem',overflow:'hidden',
            boxShadow:'0 32px 72px rgba(0,0,0,0.6),0 0 0 1px rgba(139,92,246,0.25)',
            transition:'transform 0.3s ease,box-shadow 0.3s ease',cursor:'pointer'}}
            onMouseEnter={e=>{e.currentTarget.style.transform='translateY(-6px)';e.currentTarget.style.boxShadow='0 44px 88px rgba(0,0,0,0.65),0 0 0 1px rgba(139,92,246,0.45),0 0 40px rgba(139,92,246,0.18)';}}
            onMouseLeave={e=>{e.currentTarget.style.transform='translateY(0)';e.currentTarget.style.boxShadow='0 32px 72px rgba(0,0,0,0.6),0 0 0 1px rgba(139,92,246,0.25)';}}>
            {/* Image */}
            <div style={{position:'relative',height:'320px',overflow:'hidden',background:'#111'}}>
                <img src={property.images[0]} alt={property.title}
                    style={{width:'100%',height:'100%',objectFit:'cover',display:'block',
                        transition:'transform 0.5s ease',willChange:'transform'}}
                    loading="eager" decoding="async" fetchpriority="high"
                    onMouseEnter={e=>e.currentTarget.style.transform='scale(1.05)'}
                    onMouseLeave={e=>e.currentTarget.style.transform='scale(1)'}/>
                <div style={{position:'absolute',inset:0,background:'linear-gradient(to bottom,rgba(0,0,0,0) 40%,rgba(0,0,0,0.85) 100%)'}}/>
                {/* Badges */}
                <div style={{position:'absolute',top:'0.875rem',left:'0.875rem',right:'0.875rem',display:'flex',justifyContent:'space-between',alignItems:'flex-start'}}>
                    <div style={{background:'rgba(251,191,36,0.97)',color:'#1a0f00',fontWeight:700,fontSize:'0.6875rem',
                        padding:'0.3rem 0.65rem',borderRadius:'0.45rem',display:'flex',alignItems:'center',gap:'0.275rem'}}>
                        <i className="fas fa-star" style={{fontSize:'0.5rem'}}></i> Featured
                    </div>
                    {price&&<div style={{background:'rgba(139,92,246,0.95)',color:'white',fontWeight:700,
                        fontSize:'0.8125rem',padding:'0.3rem 0.75rem',borderRadius:'0.45rem',letterSpacing:'-0.01em'}}>{price}</div>}
                </div>
                {/* Bottom info */}
                <div style={{position:'absolute',bottom:0,left:0,right:0,padding:'1.125rem 1.25rem'}}>
                    <p style={{color:'white',fontWeight:700,fontSize:'1.0625rem',margin:'0 0 0.3rem',letterSpacing:'-0.02em',lineHeight:1.3}}>{property.title}</p>
                    {property.location&&<p style={{color:'rgba(255,255,255,0.6)',fontSize:'0.775rem',margin:'0 0 0.5rem',display:'flex',alignItems:'center',gap:'0.3rem'}}>
                        <i className="fas fa-map-marker-alt" style={{fontSize:'0.6rem',color:'#a78bfa'}}></i>{property.location}
                    </p>}
                    <div style={{display:'flex',alignItems:'center',gap:'0.375rem'}}>
                        <div className="live-dot"/>
                        <span style={{color:'rgba(255,255,255,0.55)',fontSize:'0.75rem'}}>Available now</span>
                    </div>
                </div>
            </div>
            {/* Action row */}
            <div style={{padding:'1rem 1.125rem',display:'flex',gap:'0.5rem',background:'#0d0d10',borderTop:'1px solid rgba(139,92,246,0.15)'}}>
                <button onClick={()=>onView(property)}
                    style={{flex:1,background:'rgba(139,92,246,0.18)',border:'1px solid rgba(139,92,246,0.32)',
                        borderRadius:'0.625rem',padding:'0.6rem 0.875rem',color:'#c4b5fd',fontWeight:600,
                        fontSize:'0.875rem',cursor:'pointer',fontFamily:"'Geist',sans-serif",
                        transition:'background 0.15s,border-color 0.15s',outline:'none'}}
                    onMouseEnter={e=>{e.currentTarget.style.background='rgba(139,92,246,0.32)';e.currentTarget.style.borderColor='rgba(139,92,246,0.6)';}}
                    onMouseLeave={e=>{e.currentTarget.style.background='rgba(139,92,246,0.18)';e.currentTarget.style.borderColor='rgba(139,92,246,0.32)';}}>
                    <i className="fas fa-eye" style={{marginRight:'0.375rem',fontSize:'0.8rem'}}/>View Details
                </button>
                <button onClick={()=>onWhatsApp(property)}
                    style={{width:'2.625rem',height:'2.625rem',flexShrink:0,background:'rgba(22,163,74,0.18)',
                        border:'1px solid rgba(22,163,74,0.32)',borderRadius:'0.625rem',color:'#4ade80',
                        cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',
                        transition:'background 0.15s',outline:'none'}}
                    onMouseEnter={e=>e.currentTarget.style.background='rgba(22,163,74,0.32)'}
                    onMouseLeave={e=>e.currentTarget.style.background='rgba(22,163,74,0.18)'}>
                    <i className="fab fa-whatsapp" style={{fontSize:'1.2rem'}}/>
                </button>
            </div>
        </div>
    );
});

// â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const Hero = memo(function Hero({ featuredProperty, onScrollToListings, onView, onWhatsApp }) {
    return (
        <section className="hero-section">
            <div className="hero-grid"/>
            <div style={{maxWidth:'82rem',margin:'0 auto',padding:'5rem 1.5rem 4.5rem',position:'relative'}}>
                <div style={{
                    display:'grid',
                    gridTemplateColumns: featuredProperty ? 'minmax(0,1fr) minmax(0,1fr)' : '1fr',
                    gap:'2.5rem',
                    alignItems:'center'
                }} className={featuredProperty ? 'hero-grid-layout' : ''}>
                    {/* â”€â”€ Left: Text â”€â”€ */}
                    <div>
                        {/* Badge */}
                        <div className="h-a1" style={{marginBottom:'1.375rem'}}>
                            <span style={{display:'inline-flex',alignItems:'center',gap:'0.5rem',
                                padding:'0.275rem 0.875rem',borderRadius:'9999px',
                                border:'1px solid rgba(139,92,246,0.32)',background:'rgba(139,92,246,0.08)',
                                color:'#a78bfa',fontSize:'0.8125rem',fontWeight:500}}>
                                <span style={{width:'6px',height:'6px',borderRadius:'9999px',background:'#8b5cf6',
                                    flexShrink:0,boxShadow:'0 0 5px rgba(139,92,246,0.8)'}}/>
                                #1 Rental Platform in Minna
                            </span>
                        </div>

                        {/* Headline */}
                        <h1 className="h-a2" style={{fontSize:'clamp(2.75rem,5.5vw,4.5rem)',fontWeight:900,
                            letterSpacing:'-0.04em',lineHeight:1.1,color:'white',margin:'0 0 1.25rem',
                            paddingRight:'0.15em'}}>
                            Find Your{' '}
                            <em className="purple-text" style={{fontStyle:'italic',fontWeight:900,paddingRight:'0.08em'}}>Dream</em>
                            <br/>
                            <em className="purple-text" style={{fontStyle:'italic',fontWeight:900,paddingRight:'0.08em'}}>Home</em>
                            {' '}in Minna
                        </h1>

                        {/* Subtitle */}
                        <p className="h-a3" style={{fontSize:'0.9375rem',color:'#a1a1aa',lineHeight:1.75,
                            marginBottom:'2rem',maxWidth:'28rem'}}>
                            Explore verified listings across Gidan-Kwano, Gidan-Mango, Kpakungun, Gurara and more.
                            Rent smarter with our trusted community of landlords.
                        </p>

                        {/* Single CTA */}
                        <div className="h-a4" style={{display:'flex',gap:'0.75rem',flexWrap:'wrap'}}>
                            <button onClick={onScrollToListings} className="shad-btn shad-btn-violet"
                                style={{height:'3rem',fontSize:'0.9375rem',paddingLeft:'1.75rem',paddingRight:'1.75rem',
                                    borderRadius:'0.75rem',boxShadow:'0 0 28px rgba(139,92,246,0.35)'}}>
                                Explore Listings
                                <i className="fas fa-arrow-down" style={{fontSize:'0.8125rem'}}/>
                            </button>
                        </div>
                    </div>

                    {/* â”€â”€ Right: Featured card â”€â”€ */}
                    {featuredProperty && (
                        <div style={{display:'flex',justifyContent:'center',alignItems:'center'}}>
                            <FeaturedCard property={featuredProperty} onView={onView} onWhatsApp={onWhatsApp}/>
                        </div>
                    )}
                </div>
            </div>
        </section>
    );
});

// â”€â”€ Property Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PropertyCard = memo(function PropertyCard({ property, onView, onWhatsApp, onOpenLightbox, delay, isAdmin, onToggleFeatured }) {
    return (
        <article className="animate-slide-up" style={{
            animationDelay:`${delay*0.07}s`,
            borderRadius:'1.125rem',
            overflow:'hidden',
            background:'#0d0d10',
            border:'1px solid rgba(139,92,246,0.18)',
            boxShadow:'0 8px 32px rgba(0,0,0,0.45)',
            transition:'transform 0.25s ease,box-shadow 0.25s ease,border-color 0.25s ease',
            cursor:'pointer'
        }}
        onMouseEnter={e=>{e.currentTarget.style.transform='translateY(-5px)';e.currentTarget.style.boxShadow='0 20px 48px rgba(0,0,0,0.6),0 0 0 1px rgba(139,92,246,0.4)';e.currentTarget.style.borderColor='rgba(139,92,246,0.4)';}}
        onMouseLeave={e=>{e.currentTarget.style.transform='translateY(0)';e.currentTarget.style.boxShadow='0 8px 32px rgba(0,0,0,0.45)';e.currentTarget.style.borderColor='rgba(139,92,246,0.18)';}}>
            {/* Image */}
            <div style={{position:'relative',height:'190px',overflow:'hidden',background:'#111'}}
                onClick={()=>onOpenLightbox(property.images,0)}>
                <img src={property.images[0]} alt={property.title}
                    style={{width:'100%',height:'100%',objectFit:'cover',display:'block',
                        transition:'transform 0.4s ease'}}
                    loading="lazy" decoding="async"
                    onMouseEnter={e=>e.currentTarget.style.transform='scale(1.05)'}
                    onMouseLeave={e=>e.currentTarget.style.transform='scale(1)'}/>
                <div style={{position:'absolute',inset:0,background:'linear-gradient(to bottom,rgba(0,0,0,0) 50%,rgba(0,0,0,0.7) 100%)'}}/>
                {/* Top badges */}
                <div style={{position:'absolute',top:'0.625rem',left:'0.625rem',right:'0.625rem',display:'flex',justifyContent:'space-between',alignItems:'flex-start'}}>
                    {property.featured&&(
                        <span style={{background:'rgba(251,191,36,0.97)',color:'#1a0f00',fontSize:'0.6875rem',fontWeight:700,padding:'0.2rem 0.55rem',borderRadius:'0.4rem',display:'flex',alignItems:'center',gap:'0.25rem'}}>
                            <i className="fas fa-star" style={{fontSize:'0.5rem'}}></i> Featured
                        </span>
                    )}
                    {property.images.length>1&&(
                        <span style={{marginLeft:'auto',background:'rgba(0,0,0,0.65)',color:'white',fontSize:'0.6875rem',fontWeight:500,padding:'0.2rem 0.5rem',borderRadius:'0.4rem',backdropFilter:'blur(4px)',display:'flex',alignItems:'center',gap:'0.2rem'}}>
                            <i className="fas fa-images" style={{fontSize:'0.6rem'}}></i>{property.images.length}
                        </span>
                    )}
                </div>
                {/* Location pill â€” always visible */}
                {property.location&&(
                    <div style={{position:'absolute',bottom:'0.625rem',left:'0.625rem',
                        background:'rgba(0,0,0,0.72)',backdropFilter:'blur(6px)',
                        color:'rgba(255,255,255,0.85)',fontSize:'0.7rem',fontWeight:500,
                        padding:'0.225rem 0.55rem',borderRadius:'9999px',
                        display:'flex',alignItems:'center',gap:'0.3rem',
                        border:'1px solid rgba(255,255,255,0.1)'}}>
                        ğŸ“ {property.location}
                    </div>
                )}
            </div>
            {/* Info */}
            <div style={{padding:'1rem 1.125rem',display:'flex',flexDirection:'column',gap:'0.5rem'}}
                onClick={()=>onView(property)}>
                <h3 style={{fontWeight:700,fontSize:'0.9375rem',letterSpacing:'-0.02em',
                    color:'white',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap',margin:0}}>
                    {property.title}
                </h3>
                {(()=>{ const n=Number(property.price); return property.price&&isFinite(n)&&n>0 ? (
                    <p style={{margin:0,fontSize:'0.875rem',fontWeight:700,color:'#a78bfa',letterSpacing:'-0.01em'}}>
                        â‚¦{n.toLocaleString()}<span style={{fontWeight:400,color:'#71717a',fontSize:'0.75rem'}}>/yr</span>
                    </p>
                ) : null; })()}
                <div style={{height:'1px',background:'rgba(139,92,246,0.12)'}}/>
                {/* Actions */}
                <div style={{display:'flex',gap:'0.5rem',paddingTop:'0.125rem'}}>
                    <button style={{flex:1,background:'rgba(139,92,246,0.15)',border:'1px solid rgba(139,92,246,0.3)',
                        borderRadius:'0.625rem',padding:'0.55rem 0.75rem',color:'#c4b5fd',fontWeight:600,
                        fontSize:'0.8125rem',cursor:'pointer',fontFamily:"'Geist',sans-serif",
                        transition:'background 0.15s',outline:'none',display:'flex',alignItems:'center',justifyContent:'center',gap:'0.375rem'}}
                        onClick={e=>{e.stopPropagation();onView(property);}}
                        onMouseEnter={e=>e.currentTarget.style.background='rgba(139,92,246,0.3)'}
                        onMouseLeave={e=>e.currentTarget.style.background='rgba(139,92,246,0.15)'}>
                        <i className="fas fa-eye" style={{fontSize:'0.75rem'}}/>View Details
                    </button>
                    <button style={{width:'2.5rem',height:'2.5rem',flexShrink:0,background:'rgba(22,163,74,0.15)',
                        border:'1px solid rgba(22,163,74,0.3)',borderRadius:'0.625rem',color:'#4ade80',
                        cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',
                        transition:'background 0.15s',outline:'none'}}
                        onClick={e=>{e.stopPropagation();onWhatsApp(property);}}
                        onMouseEnter={e=>e.currentTarget.style.background='rgba(22,163,74,0.3)'}
                        onMouseLeave={e=>e.currentTarget.style.background='rgba(22,163,74,0.15)'}>
                        <i className="fab fa-whatsapp" style={{fontSize:'1.125rem'}}/>
                    </button>
                    {isAdmin&&onToggleFeatured&&(
                        <button className={`star-btn ${property.featured===true?'active':''}`}
                            onClick={e=>{e.stopPropagation();onToggleFeatured(property);}}
                            title={property.featured?'Remove featured':'Set as featured'}>
                            <i className="fas fa-star" style={{fontSize:'0.75rem'}}/>
                        </button>
                    )}
                </div>
            </div>
        </article>
    );
});

// â”€â”€ Skeleton Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SkeletonCard() {
    return (
        <div className="shad-card overflow-hidden">
            <div className="skeleton" style={{height:'13rem'}}></div>
            <div style={{padding:'1.125rem',display:'flex',flexDirection:'column',gap:'0.625rem'}}>
                <div className="skeleton rounded" style={{height:'0.875rem',width:'70%'}}></div>
                <div className="skeleton rounded w-full" style={{height:'0.75rem'}}></div>
                <div className="skeleton rounded" style={{height:'0.75rem',width:'55%'}}></div>
                <div className="skeleton rounded-lg mt-2 w-full" style={{height:'2.25rem'}}></div>
            </div>
        </div>
    );
}

// â”€â”€ Admin Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AdminForm({ onSave }) {
    const [form,setForm] = useState({title:'',location:'',description:'',price:'',videoLink:'',images:[],whatsappNumber:'+234'});
    const [saving,setSaving] = useState(false);
    const set = useCallback((k,v)=>setForm(prev=>({...prev,[k]:v})),[]);
    const onFiles = useCallback(e=>{
        const ALLOWED_TYPES = ['image/jpeg','image/png','image/webp','image/gif'];
        const MAX_FILE_SIZE = 15 * 1024 * 1024; // 15MB per file
        Array.from(e.target.files).forEach(file=>{
            // Validate MIME type â€” not just accept attribute
            if(!ALLOWED_TYPES.includes(file.type)){
                alert(`"${file.name}" is not an allowed image type. Use JPG, PNG, WebP or GIF.`);
                return;
            }
            if(file.size > MAX_FILE_SIZE){
                alert(`"${file.name}" is too large (max 15MB).`);
                return;
            }
            const reader=new FileReader();
            reader.onload=ev=>{
                // Double-check: real images produce a data URL starting with data:image/
                const result = ev.target.result;
                if(!result.startsWith('data:image/')){
                    alert(`"${file.name}" does not appear to be a valid image.`);
                    return;
                }
                compressImage(result,1200,900,0.78).then(compressed=>{
                    setForm(prev=>{if(prev.images.length>=10)return prev;return{...prev,images:[...prev.images,compressed]};});
                });
            };
            reader.readAsDataURL(file);
        });
    },[]);
    const removeImg = useCallback(i=>setForm(prev=>({...prev,images:prev.images.filter((_,j)=>j!==i)})),[]);
    // Sanitize plain text â€” strip any HTML tags
    const sanitize = v => String(v).replace(/<[^>]*>/g,'').trim();

    // Only allow https youtube/vimeo/maps video links
    const isValidVideoUrl = url => {
        if(!url) return true; // optional field
        try {
            const u = new URL(url);
            if(u.protocol !== 'https:') return false;
            return /^(www\.)?(youtube\.com|youtu\.be|vimeo\.com|maps\.google\.com)$/.test(u.hostname);
        } catch { return false; }
    };

    // Validate WhatsApp number â€” digits, +, spaces only, 7-15 digits
    const isValidWhatsApp = n => /^\+?[\d\s\-]{7,15}$/.test(n.replace(/\s/g,''));

    // Validate price â€” positive number if present
    const isValidPrice = p => !p || (/^\d+(\.\d{1,2})?$/.test(p) && Number(p) > 0 && Number(p) < 100000000);

    const submit = async e=>{
        e.preventDefault();
        const title    = sanitize(form.title);
        const location = sanitize(form.location);
        const desc     = sanitize(form.description);
        const video    = form.videoLink.trim();
        const phone    = form.whatsappNumber.trim();

        if(!title)            { alert('Title is required'); return; }
        if(title.length > 120){ alert('Title max 120 characters'); return; }
        if(!location)         { alert('Location is required'); return; }
        if(location.length > 100){ alert('Location max 100 characters'); return; }
        if(!desc)             { alert('Description is required'); return; }
        if(desc.length > 300) { alert('Description max 300 chars'); return; }
        if(!form.images.length){ alert('At least one image is required'); return; }
        if(video && !isValidVideoUrl(video)){ alert('Video link must be a valid YouTube or Vimeo https:// URL'); return; }
        if(!isValidWhatsApp(phone)){ alert('Enter a valid WhatsApp number (e.g. +2348012345678)'); return; }
        if(!isValidPrice(form.price)){ alert('Price must be a valid positive number'); return; }

        const clean = {
            title,
            location,
            description: desc,
            price: form.price ? String(Number(form.price)) : '',
            videoLink: video,
            whatsappNumber: phone.replace(/[^\d+]/g,''),
            images: form.images,
            featured: false,
            createdAt: new Date().toISOString()
        };
        try{
            setSaving(true);
            await onSave(clean);
            setForm({title:'',location:'',description:'',price:'',videoLink:'',images:[],whatsappNumber:'+234'});
            alert('Property added!');
        } catch(err){ alert('Error: '+err.message); } finally{ setSaving(false); }
    };
    return(
        <form onSubmit={submit} style={{display:'flex',flexDirection:'column',gap:'1.125rem'}}>
            <div>
                <label className="shad-label">Title *</label>
                <input type="text" value={form.title} onChange={e=>set('title',e.target.value)} className="shad-input" placeholder="e.g. 3-Bed Flat, Gidan-Mango"/>
            </div>
            <div>
                <label className="shad-label">ğŸ“ Location *</label>
                <input type="text" value={form.location} onChange={e=>set('location',e.target.value)} className="shad-input" placeholder="e.g. Gidan-Mango, Minna"/>
            </div>
            <div>
                <label className="shad-label">Price (â‚¦/yr) <span className="shad-muted">(optional)</span></label>
                <input type="number" value={form.price} onChange={e=>set('price',e.target.value)} className="shad-input" placeholder="e.g. 500000"/>
            </div>
            <div>
                <label className="shad-label">Description * <span className="shad-muted">(max 300)</span></label>
                <textarea value={form.description} onChange={e=>set('description',e.target.value)} maxLength={300} rows={4} className="shad-textarea" placeholder="Describe the property..."/>
                <p className="shad-muted mt-1" style={{color:form.description.length>270?'#ef4444':undefined}}>{form.description.length}/300</p>
            </div>
            <div>
                <label className="shad-label">Video Link <span className="shad-muted">(optional)</span></label>
                <input type="url" value={form.videoLink} onChange={e=>set('videoLink',e.target.value)} className="shad-input" placeholder="https://youtube.com/..."/>
            </div>
            <div>
                <label className="shad-label">WhatsApp Number *</label>
                <input type="text" value={form.whatsappNumber} onChange={e=>set('whatsappNumber',e.target.value)} className="shad-input" placeholder="+2348012345678"/>
            </div>
            <div>
                <label className="shad-label">Images * <span className="shad-muted">(max 10)</span></label>
                <input type="file" multiple accept="image/*" onChange={onFiles} className="shad-input" style={{height:'auto',padding:'0.375rem',cursor:'pointer'}}/>
                {form.images.length>0&&(
                    <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:'0.5rem',marginTop:'0.75rem'}}>
                        {form.images.map((img,i)=>(
                            <div key={i} style={{position:'relative',aspectRatio:'1',borderRadius:'0.5rem',overflow:'hidden'}}
                                onMouseEnter={e=>e.currentTarget.querySelector('button').style.opacity='1'}
                                onMouseLeave={e=>e.currentTarget.querySelector('button').style.opacity='0'}>
                                <img src={img} style={{width:'100%',height:'100%',objectFit:'cover'}} loading="lazy" decoding="async"/>
                                <button type="button" onClick={()=>removeImg(i)}
                                    style={{position:'absolute',top:'0.25rem',right:'0.25rem',width:'1.375rem',height:'1.375rem',background:'#ef4444',border:'none',borderRadius:'9999px',color:'white',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',opacity:0,transition:'opacity 0.15s'}}>
                                    <i className="fas fa-times" style={{fontSize:'0.5625rem'}}></i>
                                </button>
                            </div>
                        ))}
                    </div>
                )}
            </div>
            <button type="submit" disabled={saving} className="shad-btn shad-btn-default" style={{height:'2.75rem',borderRadius:'0.625rem',opacity:saving?0.7:1,width:'100%'}}>
                {saving?<><span className="spinner mr-2"></span>Saving...</>:<><i className="fas fa-plus-circle mr-1"></i>Add Property</>}
            </button>
        </form>
    );
}

// â”€â”€ Detail Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DetailPage({ property, darkMode, toggleDarkMode, onBack, onWhatsApp, onOpenLightbox, onOpenAdminLogin }) {
    const [idx,setIdx] = useState(0);
    const goNext = useCallback(()=>setIdx(i=>(i+1)%property.images.length),[property.images.length]);
    const goPrev = useCallback(()=>setIdx(i=>(i-1+property.images.length)%property.images.length),[property.images.length]);
    function linkify(text){
        if(!text) return null;
        return text.split(/(https?:\/\/[^\s]+)/g).map((p,i)=>{
            if(!/^https?:\/\//.test(p)) return p;
            // Only hyperlink safe, known domains
            try {
                const u = new URL(p);
                const SAFE = /^(www\.)?(youtube\.com|youtu\.be|vimeo\.com|maps\.google\.com|google\.com|instagram\.com|facebook\.com|twitter\.com|x\.com)$/;
                if(u.protocol !== 'https:' || !SAFE.test(u.hostname)) return p; // show as plain text
            } catch { return p; }
            return <a key={i} href={p} target="_blank" rel="noopener noreferrer" style={{color:'var(--violet)',textDecoration:'underline'}}>{p}</a>;
        });
    }
    return(
        <div className="animate-fade-in" style={{minHeight:'100vh',background:'var(--background)'}}>
            <Header currentPage="details" darkMode={darkMode} toggleDarkMode={toggleDarkMode} onNavigateHome={onBack} onOpenAdminLogin={onOpenAdminLogin}/>
            <div style={{maxWidth:'56rem',margin:'0 auto',padding:'1.5rem 1.5rem 4rem'}}>
                <button onClick={onBack} className="shad-btn shad-btn-ghost" style={{width:'auto',gap:'0.5rem',color:'var(--muted-foreground)',paddingLeft:0,paddingRight:'0.75rem',marginBottom:'1.5rem'}}>
                    <i className="fas fa-arrow-left" style={{fontSize:'0.8125rem'}}></i>Back to listings
                </button>
                <div className="shad-card overflow-hidden">
                    <div className="gallery-main" style={{cursor:'pointer'}} onClick={()=>onOpenLightbox(property.images,idx)}>
                        <LazyImg src={property.images[idx]} alt={property.title} className="w-full h-full object-cover"/>
                        <div style={{position:'absolute',inset:0,display:'flex',alignItems:'center',justifyContent:'center',opacity:0,transition:'opacity 0.2s'}}
                            onMouseEnter={e=>e.currentTarget.style.opacity='1'} onMouseLeave={e=>e.currentTarget.style.opacity='0'}>
                            <span style={{background:'var(--background)',border:'1px solid var(--border)',color:'var(--foreground)',padding:'0.5rem 1rem',borderRadius:'9999px',fontSize:'0.8125rem',fontWeight:500,boxShadow:'0 4px 12px rgba(0,0,0,0.1)'}}>
                                <i className="fas fa-expand mr-2" style={{color:'var(--violet)'}}></i>View full size
                            </span>
                        </div>
                        {property.images.length>1&&<>
                            <button onClick={e=>{e.stopPropagation();goPrev();}} style={{position:'absolute',left:'0.75rem',top:'50%',transform:'translateY(-50%)',width:'2.5rem',height:'2.5rem',borderRadius:'9999px',background:'var(--background)',border:'1px solid var(--border)',color:'var(--foreground)',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center'}}>
                                <i className="fas fa-chevron-left" style={{fontSize:'0.75rem'}}></i>
                            </button>
                            <button onClick={e=>{e.stopPropagation();goNext();}} style={{position:'absolute',right:'0.75rem',top:'50%',transform:'translateY(-50%)',width:'2.5rem',height:'2.5rem',borderRadius:'9999px',background:'var(--background)',border:'1px solid var(--border)',color:'var(--foreground)',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center'}}>
                                <i className="fas fa-chevron-right" style={{fontSize:'0.75rem'}}></i>
                            </button>
                        </>}
                    </div>
                    {property.images.length>1&&(
                        <div style={{padding:'0.875rem 1.25rem',borderTop:'1px solid var(--border)',background:'var(--muted)',display:'flex',flexWrap:'wrap',gap:'0.375rem'}}>
                            {property.images.map((img,i)=>(
                                <div key={i} onClick={()=>onOpenLightbox(property.images,i)} className={`thumb ${idx===i?'active':''}`} style={{width:'4.5rem',height:'4.5rem'}}>
                                    <LazyImg src={img} alt={`Photo ${i+1}`} className="w-full h-full object-cover"/>
                                </div>
                            ))}
                        </div>
                    )}
                    <div style={{padding:'1.75rem 2rem',display:'flex',flexDirection:'column',gap:'1.25rem'}}>
                        <h1 style={{fontWeight:800,fontSize:'1.5rem',letterSpacing:'-0.03em',color:'var(--foreground)',margin:0,lineHeight:1.2}}>{property.title}</h1>
                        <div className="shad-separator"></div>
                        <div>
                            <p className="shad-label" style={{marginBottom:'0.5rem'}}>Description</p>
                            <p style={{fontSize:'0.9375rem',lineHeight:1.75,color:'var(--muted-foreground)',whiteSpace:'pre-wrap',margin:0}}>{linkify(property.description)}</p>
                        </div>
                        {property.videoLink&&(()=>{
                            // Only render links that are safe https youtube/vimeo URLs
                            let safeVideo = null;
                            try {
                                const u = new URL(property.videoLink);
                                if(u.protocol==='https:' && /^(www\.)?(youtube\.com|youtu\.be|vimeo\.com)$/.test(u.hostname)){
                                    safeVideo = property.videoLink;
                                }
                            } catch{}
                            return safeVideo ? (<>
                                <div className="shad-separator"></div>
                                <div>
                                    <p className="shad-label" style={{marginBottom:'0.5rem'}}>Video Tour</p>
                                    <a href={safeVideo} target="_blank" rel="noopener noreferrer" className="shad-btn shad-btn-outline" style={{width:'auto',display:'inline-flex',color:'#ef4444',borderColor:'rgba(239,68,68,0.3)'}}>
                                        <i className="fab fa-youtube"></i>Watch Tour
                                    </a>
                                </div>
                            </>) : null;
                        })()}
                        <div className="shad-separator"></div>
                        <div>
                            <p className="shad-muted" style={{marginBottom:'1rem'}}>Interested? Reach out directly.</p>
                            <button onClick={()=>onWhatsApp(property)} className="shad-btn shad-btn-green">
                                <i className="fab fa-whatsapp" style={{fontSize:'1.125rem'}}></i>Contact on WhatsApp
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
}

// â”€â”€ Edit Property Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function EditModal({ property, onSave, onClose }) {
    const [form, setForm] = useState({
        title:         property.title         || '',
        location:      property.location      || '',
        price:         property.price         || '',
        description:   property.description   || '',
        videoLink:     property.videoLink      || '',
        whatsappNumber:property.whatsappNumber || '+234',
        images:        property.images         || [],
    });
    const [saving, setSaving]   = useState(false);
    const [err,    setErr]      = useState('');
    const set = (k,v) => setForm(prev=>({...prev,[k]:v}));

    const ALLOWED_TYPES = ['image/jpeg','image/png','image/webp','image/gif'];
    const onFiles = e => {
        Array.from(e.target.files).forEach(file=>{
            if(!ALLOWED_TYPES.includes(file.type)){ alert(`"${file.name}" is not an allowed type.`); return; }
            if(file.size > 15*1024*1024){ alert(`"${file.name}" is too large (max 15MB).`); return; }
            const reader = new FileReader();
            reader.onload = ev => {
                const result = ev.target.result;
                if(!result.startsWith('data:image/')){ alert('Invalid image file.'); return; }
                compressImage(result,1200,900,0.78).then(compressed=>{
                    setForm(prev=>prev.images.length>=10?prev:{...prev,images:[...prev.images,compressed]});
                });
            };
            reader.readAsDataURL(file);
        });
    };
    const removeImg = i => setForm(prev=>({...prev,images:prev.images.filter((_,j)=>j!==i)}));

    const sanitize = v => String(v).replace(/<[^>]*>/g,'').trim();
    const isValidVideoUrl = url => {
        if(!url) return true;
        try {
            const u = new URL(url);
            if(u.protocol !== 'https:') return false;
            return /^(www\.)?(youtube\.com|youtu\.be|vimeo\.com)$/.test(u.hostname);
        } catch { return false; }
    };

    const submit = async e => {
        e.preventDefault();
        setErr('');
        const title    = sanitize(form.title);
        const location = sanitize(form.location);
        const desc     = sanitize(form.description);
        const video    = form.videoLink.trim();
        const phone    = form.whatsappNumber.trim();
        if(!title)                              { setErr('Title is required'); return; }
        if(title.length > 120)                  { setErr('Title max 120 characters'); return; }
        if(!location)                           { setErr('Location is required'); return; }
        if(!desc)                               { setErr('Description is required'); return; }
        if(desc.length > 300)                   { setErr('Description max 300 chars'); return; }
        if(!form.images.length)                 { setErr('At least one image is required'); return; }
        if(video && !isValidVideoUrl(video))    { setErr('Video must be a valid YouTube/Vimeo https:// link'); return; }
        if(!/^\+?[\d\s\-]{7,15}$/.test(phone.replace(/\s/g,''))){ setErr('Enter a valid WhatsApp number'); return; }
        const rawPrice = Number(form.price);
        if(form.price && (!isFinite(rawPrice)||rawPrice<=0||rawPrice>=100000000)){ setErr('Enter a valid price'); return; }

        const clean = {
            title, location, description: desc,
            price:          form.price ? String(rawPrice) : '',
            videoLink:      video.substring(0,300),
            whatsappNumber: phone.replace(/[^\d+]/g,'').substring(0,20),
            images:         form.images.slice(0,10),
            featured:       property.featured || false,
            createdAt:      property.createdAt || new Date().toISOString(),
            updatedAt:      new Date().toISOString(),
        };
        try {
            setSaving(true);
            await onSave(property.id, clean);
            onClose();
        } catch(e){ setErr('Save failed: '+e.message); }
        finally { setSaving(false); }
    };

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop"
            style={{background:'rgba(0,0,0,0.7)',overflowY:'auto'}}
            onClick={e=>{if(e.target===e.currentTarget)onClose();}}>
            <div className="modal-content shad-card shadow-2xl" style={{width:'100%',maxWidth:'32rem',padding:'1.75rem',margin:'auto',maxHeight:'90vh',overflowY:'auto'}}>
                {/* Header */}
                <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'1.5rem'}}>
                    <div>
                        <h2 style={{fontWeight:700,fontSize:'1.125rem',letterSpacing:'-0.025em',color:'var(--foreground)',margin:0}}>Edit Property</h2>
                        <p className="shad-muted" style={{marginTop:'0.2rem'}}>Update listing details</p>
                    </div>
                    <button onClick={onClose} style={{width:'2rem',height:'2rem',borderRadius:'0.5rem',background:'var(--muted)',border:'none',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',color:'var(--foreground)',transition:'background 0.15s'}}
                        onMouseEnter={e=>e.currentTarget.style.background='var(--accent)'}
                        onMouseLeave={e=>e.currentTarget.style.background='var(--muted)'}>
                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M1 1L13 13M13 1L1 13" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/></svg>
                    </button>
                </div>

                {err&&<div style={{background:'rgba(239,68,68,0.08)',border:'1px solid rgba(239,68,68,0.25)',borderRadius:'0.5rem',padding:'0.625rem 0.875rem',marginBottom:'1rem',color:'#ef4444',fontSize:'0.8125rem'}}>{err}</div>}

                <form onSubmit={submit} style={{display:'flex',flexDirection:'column',gap:'1rem'}}>
                    <div>
                        <label className="shad-label">Title *</label>
                        <input value={form.title} onChange={e=>set('title',e.target.value)} className="shad-input" placeholder="e.g. 3-Bed Flat, Gidan-Mango"/>
                    </div>
                    <div>
                        <label className="shad-label">ğŸ“ Location *</label>
                        <input value={form.location} onChange={e=>set('location',e.target.value)} className="shad-input" placeholder="e.g. Gidan-Mango, Minna"/>
                    </div>
                    <div>
                        <label className="shad-label">Price (â‚¦/yr) <span className="shad-muted">(optional)</span></label>
                        <input type="number" value={form.price} onChange={e=>set('price',e.target.value)} className="shad-input" placeholder="e.g. 500000"/>
                    </div>
                    <div>
                        <label className="shad-label">Description * <span className="shad-muted">(max 300)</span></label>
                        <textarea value={form.description} onChange={e=>set('description',e.target.value)} maxLength={300} rows={4} className="shad-textarea" placeholder="Describe the property..."/>
                        <p className="shad-muted" style={{marginTop:'0.25rem',color:form.description.length>270?'#ef4444':undefined}}>{form.description.length}/300</p>
                    </div>
                    <div>
                        <label className="shad-label">Video Link <span className="shad-muted">(optional)</span></label>
                        <input type="url" value={form.videoLink} onChange={e=>set('videoLink',e.target.value)} className="shad-input" placeholder="https://youtube.com/..."/>
                    </div>
                    <div>
                        <label className="shad-label">WhatsApp Number *</label>
                        <input value={form.whatsappNumber} onChange={e=>set('whatsappNumber',e.target.value)} className="shad-input" placeholder="+2348012345678"/>
                    </div>
                    <div>
                        <label className="shad-label">Images <span className="shad-muted">({form.images.length}/10 â€” add more or remove existing)</span></label>
                        <input type="file" multiple accept="image/*" onChange={onFiles} className="shad-input" style={{height:'auto',padding:'0.375rem',cursor:'pointer'}}/>
                        {form.images.length>0&&(
                            <div style={{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:'0.375rem',marginTop:'0.625rem'}}>
                                {form.images.map((img,i)=>(
                                    <div key={i} style={{position:'relative',aspectRatio:'1',borderRadius:'0.5rem',overflow:'hidden'}}
                                        onMouseEnter={e=>e.currentTarget.querySelector('button').style.opacity='1'}
                                        onMouseLeave={e=>e.currentTarget.querySelector('button').style.opacity='0'}>
                                        <img src={img} style={{width:'100%',height:'100%',objectFit:'cover'}} loading="lazy"/>
                                        <button type="button" onClick={()=>removeImg(i)}
                                            style={{position:'absolute',top:'0.2rem',right:'0.2rem',width:'1.25rem',height:'1.25rem',background:'#ef4444',border:'none',borderRadius:'9999px',color:'white',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',opacity:0,transition:'opacity 0.15s',fontSize:'0.5rem'}}>
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                    <div style={{display:'flex',gap:'0.5rem',paddingTop:'0.25rem'}}>
                        <button type="button" onClick={onClose} className="shad-btn shad-btn-outline" style={{flex:1,height:'2.75rem',borderRadius:'0.625rem'}}>Cancel</button>
                        <button type="submit" disabled={saving} className="shad-btn shad-btn-default" style={{flex:2,height:'2.75rem',borderRadius:'0.625rem',opacity:saving?0.7:1}}>
                            {saving?<><span className="spinner" style={{marginRight:'0.5rem'}}></span>Saving...</>:<><i className="fas fa-check" style={{marginRight:'0.375rem'}}></i>Save Changes</>}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
}

// â”€â”€ Confirm Delete Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ConfirmModal({ title, message, onConfirm, onCancel }) {
    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop"
            style={{background:'rgba(0,0,0,0.65)'}}
            onClick={e=>{if(e.target===e.currentTarget)onCancel();}}>
            <div className="modal-content" style={{
                background:'var(--card)',border:'1px solid var(--border)',borderRadius:'1rem',
                padding:'1.75rem',width:'100%',maxWidth:'22rem',
                boxShadow:'0 24px 64px rgba(0,0,0,0.5)'}}>
                <div style={{width:'3rem',height:'3rem',borderRadius:'0.75rem',background:'rgba(239,68,68,0.1)',
                    border:'1px solid rgba(239,68,68,0.25)',display:'flex',alignItems:'center',
                    justifyContent:'center',margin:'0 auto 1.25rem'}}>
                    <i className="fas fa-trash" style={{fontSize:'1rem',color:'#ef4444'}}></i>
                </div>
                <h3 style={{fontWeight:700,fontSize:'1.0625rem',color:'var(--foreground)',
                    textAlign:'center',margin:'0 0 0.5rem',letterSpacing:'-0.02em'}}>{title}</h3>
                <p style={{fontSize:'0.875rem',color:'var(--muted-foreground)',textAlign:'center',
                    margin:'0 0 1.5rem',lineHeight:1.6}}>{message}</p>
                <div style={{display:'flex',gap:'0.625rem'}}>
                    <button onClick={onCancel} className="shad-btn shad-btn-outline"
                        style={{flex:1,height:'2.625rem',borderRadius:'0.625rem'}}>Cancel</button>
                    <button onClick={onConfirm}
                        style={{flex:1,height:'2.625rem',borderRadius:'0.625rem',background:'#ef4444',
                            color:'white',border:'none',fontWeight:600,fontSize:'0.875rem',
                            cursor:'pointer',fontFamily:"'Geist',sans-serif",transition:'background 0.15s'}}
                        onMouseEnter={e=>e.currentTarget.style.background='#dc2626'}
                        onMouseLeave={e=>e.currentTarget.style.background='#ef4444'}>
                        Delete
                    </button>
                </div>
            </div>
        </div>
    );
}

// â”€â”€ Admin Login Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Uses Firebase Authentication â€” add any admin in Firebase Console, no code changes needed
function AdminLoginModal({ onLogin, onClose }) {
    const [email,setEmail]       = useState('');
    const [pwd,setPwd]           = useState('');
    const [err,setErr]           = useState('');
    const [busy,setBusy]         = useState(false);
    const [attempts,setAttempts] = useState(0);
    const [cooldown,setCooldown] = useState(0); // seconds remaining

    // Cooldown timer â€” counts down every second
    useEffect(()=>{
        if(cooldown <= 0) return;
        const t = setTimeout(()=>setCooldown(c=>c-1), 1000);
        return ()=>clearTimeout(t);
    },[cooldown]);

    const attempt = async () => {
        if(cooldown > 0) return;
        if (!email.trim() || !pwd.trim()) { setErr('Please enter both email and password.'); return; }

        // Basic email format check client-side
        if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.trim())){
            setErr('Enter a valid email address.'); return;
        }

        setBusy(true);
        setErr('');
        try {
            await firebase.auth().signInWithEmailAndPassword(email.trim(), pwd);
            onLogin();
        } catch(e) {
            const code = e.code || '';
            const newAttempts = attempts + 1;
            setAttempts(newAttempts);

            if (code === 'auth/wrong-password' || code === 'auth/invalid-credential' || code === 'auth/user-not-found') {
                setErr(`Incorrect email or password.${newAttempts >= 3 ? ` (${newAttempts} failed attempts)` : ''}`);
            } else if (code === 'auth/too-many-requests') {
                setErr('Account temporarily locked by Firebase. Try again later.');
                setCooldown(60);
            } else if (code === 'auth/network-request-failed') {
                setErr('Network error â€” check your connection.');
            } else {
                setErr('Login failed. Please try again.');
            }

            // Client-side cooldown after 5 failed attempts
            if(newAttempts >= 5){
                setCooldown(30);
                setErr('Too many failed attempts. Wait 30 seconds before trying again.');
            }
            setTimeout(()=>setErr(err=>err), 6000);
        }
        setBusy(false);
    };

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop"
            style={{background:'rgba(0,0,0,0.55)'}}
            onClick={e=>{if(e.target===e.currentTarget)onClose();}}>
            <div className="shad-card modal-content shadow-2xl" style={{width:'100%',maxWidth:'22rem',padding:'1.75rem'}}>
                <div style={{textAlign:'center',marginBottom:'1.5rem'}}>
                    <div style={{width:'3rem',height:'3rem',borderRadius:'0.75rem',background:'var(--muted)',border:'1px solid var(--border)',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 0.875rem'}}>
                        <i className="fas fa-lock" style={{fontSize:'1rem',color:'var(--foreground)'}}></i>
                    </div>
                    <h2 style={{fontWeight:700,fontSize:'1.125rem',letterSpacing:'-0.025em',color:'var(--foreground)',margin:'0 0 0.25rem'}}>Admin Access</h2>
                    <p className="shad-muted">Sign in to manage listings</p>
                </div>
                <div style={{display:'flex',flexDirection:'column',gap:'0.625rem',marginBottom:err?'0.5rem':'1rem'}}>
                    <input type="email" value={email} onChange={e=>{setEmail(e.target.value);setErr('');}}
                        onKeyDown={e=>e.key==='Enter'&&attempt()} autoFocus placeholder="Email"
                        className="shad-input" style={{borderColor:err?'#ef4444':undefined}}/>
                    <input type="password" value={pwd} onChange={e=>{setPwd(e.target.value);setErr('');}}
                        onKeyDown={e=>e.key==='Enter'&&attempt()} placeholder="Password"
                        className="shad-input" style={{borderColor:err?'#ef4444':undefined}}/>
                </div>
                {err&&<p style={{color:'#ef4444',fontSize:'0.8125rem',marginBottom:'0.75rem',lineHeight:1.4}}>{err}</p>}
                <div style={{display:'flex',gap:'0.5rem'}}>
                    <button onClick={attempt} disabled={busy} className="shad-btn shad-btn-default" style={{flex:1,height:'2.625rem',borderRadius:'0.625rem',opacity:busy?0.7:1}}>
                        {busy?<><span className="spinner mr-2"></span>Signing in...</>:'Login'}
                    </button>
                    <button onClick={onClose} className="shad-btn shad-btn-outline" style={{flex:1,height:'2.625rem',borderRadius:'0.625rem'}}>Cancel</button>
                </div>
                <p style={{fontSize:'0.6875rem',color:'var(--muted-foreground)',textAlign:'center',marginTop:'1rem',lineHeight:1.5}}>
                    ğŸ”’ Secured with Firebase Authentication
                </p>
            </div>
        </div>
    );
}

// â”€â”€ Admin Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const AdminPage = memo(function AdminPage({ properties, darkMode, toggleDarkMode, onLogout, onSave, onDelete, onEdit, onToggleFeatured, onOpenLightbox, onOpenAdminLogin }) {
    return (
        <div style={{minHeight:'100vh',background:'var(--background)'}}>
            <Header currentPage="admin" darkMode={darkMode} toggleDarkMode={toggleDarkMode} onNavigateHome={onLogout} onOpenAdminLogin={onOpenAdminLogin}/>
            <div style={{maxWidth:'80rem',margin:'0 auto',padding:'2rem 1.5rem 4rem'}}>
                <div style={{display:'flex',flexWrap:'wrap',justifyContent:'space-between',alignItems:'flex-start',gap:'1rem',marginBottom:'1.75rem'}} className="animate-slide-up">
                    <div>
                        <h1 style={{fontWeight:800,fontSize:'1.5rem',letterSpacing:'-0.03em',color:'var(--foreground)',margin:0}}>Admin Panel</h1>
                        <p className="shad-muted" style={{marginTop:'0.25rem'}}>Manage your property listings</p>
                    </div>
                    <button onClick={onLogout} className="shad-btn shad-btn-outline" style={{color:'#ef4444',borderColor:'rgba(239,68,68,0.3)'}}>
                        <i className="fas fa-sign-out-alt"></i>Logout
                    </button>
                </div>
                {/* Featured tip */}
                <div style={{background:'rgba(251,191,36,0.07)',border:'1px solid rgba(251,191,36,0.22)',borderRadius:'0.75rem',padding:'0.75rem 1rem',marginBottom:'1.75rem',display:'flex',alignItems:'center',gap:'0.75rem'}} className="animate-slide-up">
                    <i className="fas fa-star" style={{color:'#f59e0b',fontSize:'0.875rem',flexShrink:0}}></i>
                    <p style={{fontSize:'0.8125rem',color:'var(--foreground)',margin:0}}>
                        <strong>Featured listing</strong> â€” click the â˜… on any listing to show it in the hero section. Only one property is featured at a time.
                    </p>
                </div>
                <div style={{display:'grid',gridTemplateColumns:'1fr',gap:'1.75rem'}} className="lg:grid-cols-2">
                    <div className="shad-card animate-slide-up" style={{padding:'1.5rem',animationDelay:'0.05s'}}>
                        <h2 style={{fontWeight:600,fontSize:'1rem',color:'var(--foreground)',marginBottom:'1.5rem',marginTop:0}}>Add New Property</h2>
                        <AdminForm onSave={onSave}/>
                    </div>
                    <div className="shad-card animate-slide-up" style={{padding:'1.5rem',animationDelay:'0.1s'}}>
                        <h2 style={{fontWeight:600,fontSize:'1rem',color:'var(--foreground)',marginBottom:'1.5rem',marginTop:0}}>
                            Listings <span className="shad-muted" style={{fontWeight:400}}>({properties.length})</span>
                        </h2>
                        <div style={{display:'flex',flexDirection:'column',gap:'0.625rem',maxHeight:'680px',overflowY:'auto'}}>
                            {properties.length===0?(
                                <div style={{textAlign:'center',padding:'4rem 1rem'}}>
                                    <i className="fas fa-home" style={{fontSize:'2.5rem',color:'var(--muted-foreground)',opacity:0.4,display:'block',marginBottom:'0.75rem'}}></i>
                                    <p className="shad-muted">No properties yet</p>
                                </div>
                            ):properties.map(p=>(
                                <div key={p.id} style={{display:'flex',alignItems:'flex-start',gap:'0.75rem',padding:'0.75rem',borderRadius:'0.625rem',border:'1px solid var(--border)',transition:'background 0.15s'}}
                                    onMouseEnter={e=>e.currentTarget.style.background='var(--muted)'}
                                    onMouseLeave={e=>e.currentTarget.style.background='transparent'}>
                                    <img src={p.images[0]} alt={p.title} loading="lazy" decoding="async"
                                        onClick={()=>onOpenLightbox(p.images,0)}
                                        style={{width:'4rem',height:'4rem',objectFit:'cover',borderRadius:'0.5rem',flexShrink:0,cursor:'pointer',transition:'opacity 0.15s'}}
                                        onMouseEnter={e=>e.currentTarget.style.opacity='0.75'} onMouseLeave={e=>e.currentTarget.style.opacity='1'}/>
                                    <div style={{flex:1,minWidth:0}}>
                                        <div style={{display:'flex',alignItems:'center',gap:'0.375rem',marginBottom:'0.2rem'}}>
                                            <p style={{fontWeight:600,fontSize:'0.875rem',color:'var(--foreground)',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap',margin:0}}>{p.title}</p>
                                            {p.featured&&<span style={{background:'rgba(251,191,36,0.14)',border:'1px solid rgba(251,191,36,0.35)',color:'#d97706',fontSize:'0.625rem',fontWeight:700,padding:'0.1rem 0.375rem',borderRadius:'9999px',flexShrink:0}}>â˜… Featured</span>}
                                        </div>
                                        <p style={{fontSize:'0.75rem',color:'var(--muted-foreground)',overflow:'hidden',display:'-webkit-box',WebkitLineClamp:2,WebkitBoxOrient:'vertical',margin:0,lineHeight:1.5}}>{p.description}</p>
                                    </div>
                                    <div style={{display:'flex',gap:'0.375rem',flexShrink:0}}>
                                        <button onClick={()=>onEdit(p)}
                                            style={{width:'2rem',height:'2rem',background:'transparent',border:'1px solid rgba(139,92,246,0.3)',borderRadius:'0.5rem',color:'#a78bfa',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',transition:'all 0.15s'}}
                                            title="Edit listing"
                                            onMouseEnter={e=>{e.currentTarget.style.background='rgba(139,92,246,0.2)';}}
                                            onMouseLeave={e=>{e.currentTarget.style.background='transparent';}}>
                                            <i className="fas fa-pen" style={{fontSize:'0.6rem'}}></i>
                                        </button>
                                        <button className={`star-btn ${p.featured===true?'active':''}`} onClick={()=>onToggleFeatured(p)} title={p.featured?'Remove featured':'Feature this'}>
                                            <i className="fas fa-star" style={{fontSize:'0.6875rem'}}></i>
                                        </button>
                                        <button onClick={()=>onDelete(p.id)}
                                            style={{width:'2rem',height:'2rem',background:'transparent',border:'1px solid rgba(239,68,68,0.25)',borderRadius:'0.5rem',color:'#ef4444',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',transition:'all 0.15s'}}
                                            onMouseEnter={e=>{e.currentTarget.style.background='#ef4444';e.currentTarget.style.color='white';}}
                                            onMouseLeave={e=>{e.currentTarget.style.background='transparent';e.currentTarget.style.color='#ef4444';}}>
                                            <i className="fas fa-trash" style={{fontSize:'0.6875rem'}}></i>
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
});

// â”€â”€ Home Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const HomePage = memo(function HomePage({ properties, loading, darkMode, toggleDarkMode, onView, onWhatsApp, onOpenLightbox, onOpenAdminLogin }) {
    const featured = properties.find(p=>p.featured)||null;
    const scrollToListings = useCallback(()=>{document.getElementById('listings')?.scrollIntoView({behavior:'smooth',block:'start'});},[]);
    return (
        <div style={{minHeight:'100vh',background:'var(--background)'}}>
            <Header currentPage="home" darkMode={darkMode} toggleDarkMode={toggleDarkMode} onNavigateHome={()=>{}} onOpenAdminLogin={onOpenAdminLogin}/>
            <Hero featuredProperty={featured} onScrollToListings={scrollToListings} onView={onView} onWhatsApp={onWhatsApp}/>
            <div id="listings" style={{maxWidth:'80rem',margin:'0 auto',padding:'3.5rem 1.5rem 4rem'}}>
                {loading?(
                    <>
                        <div className="skeleton" style={{height:'1.25rem',width:'9rem',borderRadius:'0.5rem',marginBottom:'1.75rem'}}></div>
                        <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(280px,1fr))',gap:'1.25rem'}}>
                            {[1,2,3].map(i=><SkeletonCard key={i}/>)}
                        </div>
                    </>
                ):properties.length===0?(
                    <div style={{textAlign:'center',padding:'6rem 1rem'}}>
                        <div style={{width:'4rem',height:'4rem',background:'var(--muted)',border:'1px solid var(--border)',borderRadius:'1rem',display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 1.25rem'}}>
                            <i className="fas fa-home" style={{fontSize:'1.5rem',color:'var(--muted-foreground)'}}></i>
                        </div>
                        <p style={{color:'var(--muted-foreground)'}}>No properties listed yet</p>
                    </div>
                ):(
                    <>
                        <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'1.75rem'}}>
                            <h2 style={{fontWeight:600,fontSize:'1.0625rem',letterSpacing:'-0.02em',color:'var(--foreground)',margin:0}}>
                                Available Properties
                                <span className="shad-badge" style={{marginLeft:'0.5rem',verticalAlign:'middle',fontSize:'0.75rem'}}>{properties.length}</span>
                            </h2>
                        </div>
                        <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(280px,1fr))',gap:'1.25rem'}}>
                            {properties.map((p,i)=>(
                                <PropertyCard key={p.id} property={p} onView={onView} onWhatsApp={onWhatsApp} onOpenLightbox={onOpenLightbox} delay={i} isAdmin={false}/>
                            ))}
                        </div>
                    </>
                )}
            </div>
            <footer style={{borderTop:'1px solid var(--border)',padding:'2rem 1.5rem',textAlign:'center'}}>
                <p className="shad-muted" style={{fontSize:'0.8125rem'}}>Â© {new Date().getFullYear()} LodgeMate Â· Minna, Niger State</p>
            </footer>
        </div>
    );
});

// â”€â”€ Root App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
    const [page,setPage]         = useState('home');
    const [selProp,setSelProp]   = useState(null);
    const [isAdmin,setIsAdmin]   = useState(false);
    const [properties,setProps]  = useState([]);
    const [loading,setLoading]   = useState(true);
    const [showLogin,setShowLogin]= useState(false);
    const [confirmDelete,setConfirmDelete] = useState(null); // {id, title}
    const [editProp,setEditProp]           = useState(null); // property being edited
    const [lb,setLb]             = useState({open:false,images:[],index:0});
    const [darkMode,setDarkMode] = useState(()=>{
        try{const s=localStorage.getItem('lm_dark');return s?JSON.parse(s):window.matchMedia('(prefers-color-scheme: dark)').matches;}catch{return false;}
    });

    useEffect(()=>{
        const ref=db.ref('properties');
        const handler=snap=>{
            const data=snap.val();
            setProps(data?Object.keys(data).map(k=>({id:k,...data[k]})).sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt)):[]);
            setLoading(false);
        };
        ref.on('value',handler);
        return()=>ref.off('value',handler);
    },[]);

    useEffect(()=>{
        try{localStorage.setItem('lm_dark',JSON.stringify(darkMode));}catch{}
        document.documentElement.classList.toggle('dark',darkMode);
    },[darkMode]);

    useEffect(()=>{
        const mq=window.matchMedia('(prefers-color-scheme: dark)');
        const fn=e=>{try{if(!localStorage.getItem('lm_dark'))setDarkMode(e.matches);}catch{}};
        mq.addEventListener('change',fn);return()=>mq.removeEventListener('change',fn);
    },[]);

    const toggleDark  = useCallback(()=>setDarkMode(d=>!d),[]);
    const openLb      = useCallback((images,index)=>{setLb({open:true,images,index});document.body.style.overflow='hidden';},[]);
    const closeLb     = useCallback(()=>{setLb(l=>({...l,open:false}));document.body.style.overflow='';},[]);
    const nextLb      = useCallback(()=>setLb(l=>({...l,index:(l.index+1)%l.images.length})),[]);
    const prevLb      = useCallback(()=>setLb(l=>({...l,index:(l.index-1+l.images.length)%l.images.length})),[]);
    const whatsApp    = useCallback(prop=>{
        // Strip everything except digits and leading +
        const raw = (prop.whatsappNumber||'+2348012345678').replace(/[^\d]/g,'');
        if(!raw || raw.length < 7) { alert('Invalid WhatsApp number for this listing.'); return; }
        const msg = encodeURIComponent("Hi! I'm interested in: " + String(prop.title).substring(0,100));
        window.open(`https://wa.me/${raw}?text=${msg}`,'_blank','noopener,noreferrer');
    },[]);
    const viewDetails = useCallback(prop=>{setSelProp(prop);setPage('details');window.scrollTo({top:0,behavior:'smooth'});},[]);
    const goHome      = useCallback(()=>{setPage('home');window.scrollTo({top:0,behavior:'smooth'});},[]);
    const updateProp  = useCallback(async (id, data)=>{
        // Whitelist fields, same as saveProp
        const safe = {
            title:          String(data.title        || '').substring(0,120),
            location:       String(data.location      || '').substring(0,100),
            description:    String(data.description   || '').substring(0,300),
            price:          data.price ? String(Number(data.price)||'') : '',
            videoLink:      String(data.videoLink     || '').substring(0,300),
            whatsappNumber: String(data.whatsappNumber|| '').replace(/[^\d+]/g,'').substring(0,20),
            images:         Array.isArray(data.images) ? data.images.slice(0,10) : [],
            featured:       data.featured || false,
            createdAt:      data.createdAt || new Date().toISOString(),
            updatedAt:      new Date().toISOString(),
        };
        await db.ref('properties/'+id).update(safe);
    },[]);
    const saveProp    = useCallback(async prop=>{
        const id = db.ref().child('properties').push().key;
        // Explicit whitelist â€” never spread unknown fields into DB
        const safe = {
            id,
            title:          String(prop.title        || '').substring(0, 120),
            location:       String(prop.location      || '').substring(0, 100),
            description:    String(prop.description   || '').substring(0, 300),
            price:          prop.price ? String(Number(prop.price) || '') : '',
            videoLink:      String(prop.videoLink     || '').substring(0, 300),
            whatsappNumber: String(prop.whatsappNumber|| '').replace(/[^\d+]/g,'').substring(0, 20),
            images:         Array.isArray(prop.images) ? prop.images.slice(0,10) : [],
            featured:       false,
            createdAt:      new Date().toISOString(),
        };
        await db.ref().update({['/properties/'+id]: safe});
    },[]);
    const delProp     = useCallback(id=>{
        const prop = properties.find(p=>p.id===id);
        setConfirmDelete({id, title: prop?.title || 'this property'});
    },[properties]);
    const confirmDelProp = useCallback(async ()=>{
        if(!confirmDelete) return;
        try { await db.ref('properties/'+confirmDelete.id).remove(); } catch(e){ alert('Delete failed: '+e.message); }
        setConfirmDelete(null);
    },[confirmDelete]);
    const toggleFeatured = useCallback(async prop=>{
        const isCurrentlyFeatured = prop.featured === true;
        // Build one atomic update: un-feature everyone, then feature the target (if not already featured)
        const updates={};
        // Only touch properties that currently have featured=true (to minimise writes & listener triggers)
        properties.forEach(p=>{
            if(p.featured===true && p.id!==prop.id) updates[`/properties/${p.id}/featured`] = false;
        });
        // Toggle the clicked property
        updates[`/properties/${prop.id}/featured`] = !isCurrentlyFeatured;
        await db.ref().update(updates);
    },[properties]);
    const handleLogin  = useCallback(()=>{setIsAdmin(true);setShowLogin(false);setPage('admin');},[]);
    const handleLogout = useCallback(()=>{
        firebase.auth().signOut();
        setIsAdmin(false);
        setPage('home');
    },[]);
    const openLogin    = useCallback(()=>setShowLogin(true),[]);

    // Keep isAdmin in sync with Firebase Auth state (e.g. after page refresh)
    useEffect(()=>{
        const unsub = firebase.auth().onAuthStateChanged(user=>{
            if(user){
                setIsAdmin(true);
            } else {
                setIsAdmin(false);
                setPage(p => p==='admin' ? 'home' : p);
            }
        });
        return ()=>unsub();
    },[]);

    return (
        <>
            {page==='home'&&<HomePage properties={properties} loading={loading} darkMode={darkMode} toggleDarkMode={toggleDark} onView={viewDetails} onWhatsApp={whatsApp} onOpenLightbox={openLb} onOpenAdminLogin={openLogin}/>}
            {page==='details'&&selProp&&<DetailPage property={selProp} darkMode={darkMode} toggleDarkMode={toggleDark} onBack={goHome} onWhatsApp={whatsApp} onOpenLightbox={openLb} onOpenAdminLogin={openLogin}/>}
            {page==='admin'&&isAdmin&&<AdminPage properties={properties} darkMode={darkMode} toggleDarkMode={toggleDark} onLogout={handleLogout} onSave={saveProp} onDelete={delProp} onEdit={p=>setEditProp(p)} onToggleFeatured={toggleFeatured} onOpenLightbox={openLb} onOpenAdminLogin={openLogin}/>}
            {page!=='admin'&&(
                <button onClick={openLogin} className="floating-admin" aria-label="Admin login"
                    style={{width:'3rem',height:'3rem',borderRadius:'9999px',background:'var(--foreground)',color:'var(--background)',border:'none',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',boxShadow:'0 4px 20px rgba(0,0,0,0.25)'}}>
                    <i className="fas fa-lock" style={{fontSize:'0.875rem'}}></i>
                </button>
            )}
            {lb.open&&<Lightbox images={lb.images} index={lb.index} onClose={closeLb} onNext={nextLb} onPrev={prevLb}/>}
            {showLogin&&<AdminLoginModal onLogin={handleLogin} onClose={()=>setShowLogin(false)}/>}
            {editProp&&<EditModal property={editProp} onSave={updateProp} onClose={()=>setEditProp(null)}/>}
            {confirmDelete&&<ConfirmModal
                title="Delete Property"
                message={`Are you sure you want to delete "${confirmDelete.title}"? This cannot be undone.`}
                onConfirm={confirmDelProp}
                onCancel={()=>setConfirmDelete(null)}
            />}
        </>
    );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
